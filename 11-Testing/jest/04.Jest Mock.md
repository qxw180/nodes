# Jest Mock

## [Mock Function](https://jestjs.io/docs/mock-functions)

## 场景一：捕获函数执行上下文

```JavaScript
test("Mock函数执行上下文", () => {
  // mock函数，捕获函数的调用
  const fun = jest.fn();
  runCallback(fun);
  // 预期函数被调用过
  expect(fun).toBeCalled();
  // 预期调用1次
  expect(fun.mock.calls.length).toBe(1);
});
```

## 场景二：Mock 返回值

```JavaScript
test("Mock函数返回值", () => {
  const myMock = jest.fn();
  console.log(myMock());
  // > undefined

  myMock.mockReturnValueOnce(10).mockReturnValueOnce('x').mockReturnValue(true);
  console.log(myMock(), myMock(), myMock(), myMock());
  // > 10, 'x', true, true
})
```

## 场景三：Mock 模块

Mock 模块内函数返回值

```JavaScript
import axios from 'axios';
// Mock axios
jest.mock('axios');

test("Mock模块实现", async () => {
  const users = [{name: 'Bob'}];
  const resp = {data: users};
  axios.get.mockResolvedValue(resp);

  const data = await getData();
  expect(data).toEqual(users);
});
```

只 Mock 模块的部分实现，保留剩余部分

```JavaScript
import antd from 'antd';

test("Mock模块实现", async () => {
  jest.mock('antd', () => {
    const originalModule = jest.requireActual('antd');
    return {
      ...originalModule,
      notification: {
        open: jest.fn(),
      },
    };
  });
});
```

## Mock 实现

```JavaScript
test("使用jest.fn Mock 函数实现", async () => {
  const myMockFn = jest.fn(cb => cb(null, true));
  myMockFn((err, val) => console.log(val)); // true
});

// 当需要mock其他模块中的函数
test("使用 mockImplementation Mock 函数实现", async () => {
  jest.mock('../foo'); // this happens automatically with automocking
  const foo = require('../foo');

  foo.mockImplementation(() => 42);
  foo(); // 42
});

```

TODO:mock 生效范围

TODO:Mock window 对象

TODO: 模拟网络错误， 404 500 timeout
