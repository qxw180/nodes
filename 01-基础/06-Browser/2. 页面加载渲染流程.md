# 页面加载渲染流程

在浏览器输入一个 URL 到页面加载完成大概分为以下几大步骤：

1. 页面加载
   1. DNS 寻址及 IP 解析
   2. TCP 链接
   3. 请求、响应、文档下载
2. 页面解析及渲染

## 页面解析及渲染

页面加载完成后浏览器会从上到下解析文档生成 DOM，在解析的过程中会将页面中的 CSS 内容生成 CSSOM，最后使用 DOM 和 CSSOM 生成渲染树将其绘制在浏览器上。HTML 的解析过程是可以被中断的，即**页面阻塞**。
**JS 阻塞**：当解析的过程中遇到`<script>`标签便会停止解析去处理脚本，即解析阻塞，如果是内联脚本则会在脚本运行结束之后继续进行解析，如果是外联脚本则会下载脚本运行之后继续继续解析。
**CSS 阻塞**：CSS 不会阻塞 DOM 树解析,CSS 会阻塞渲染树的解析，并且会**阻塞后面 JS 语句**的执行。

`<script>`标签使用`defer`和`async`属性可以缓解 JS 阻塞问题，但是这两个标签对 inline-script 是无效的。

## 网页加载和渲染流程

理解页面的加载和渲染流程是优化页面渲染的必要知识，浏览器的核心分为两部分，渲染引擎和 JavaScript 引擎，两个引擎交替渲染，页面的加载渲染流程大致为以下步骤：

### 页面渲染流程

1. 浏览器一边下载 HTML 网页，一边解析，构建 DOM Tree
2. 浏览器以内置默认样式构建 CSSDOM Tree， CSSDOM Tree 主要由以下几部分构成：
   1. 浏览器根据内置样式
   2. inline style 和 internal style
   3. external style
3. 使用 DOM Tree 和 CSSDOM Tree 构建 Render Tree，然后渲染页面
4. 解析过程中发现`script`标签
5. 暂停解析，网页渲染的控制权转交给 JavaScript 引擎
6. 如果 script 标签引用了外部脚本，就下载该脚本，否则就直接执行
7. 执行完毕，控制权交还渲染引擎，恢复往下解析 HTML 网页
