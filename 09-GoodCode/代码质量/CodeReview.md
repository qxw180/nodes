# Code Review

CR 可以让每次提交代码都在使仓库变的更好

1. 在需求提交前发现 bug
2. 代码分享和知识交流
3. 利于团队，每个人都对整个项目熟悉，避免个别需求和个别人的强绑定

## checklist

- 是否已有现成代码可复用后扩展已有代码
- 是否可以进一步抽象封装
- 是否移除了调试代码
- 是否可以进一步拆分 MR
- commit 描述是否足够清醒
- 是否添加必要注释
- 命名是否合理
- 是否有安全问题
- 是否有坏味道
- 是否有必要的自动化测试

## 在 CR 之前要提前执行自动化审查

- 代码规范检查
- 代码复杂度检查
- 自动化测试

## readability key point

1. 代码组织
   1. 文件命名要有一致性，即合理通用的代码目录组织及命名
   2. 工具函数适当的归类、便于理解，避免形成垃圾桶文件，把所有的公用函数都堆积到一个代码文件内管理
2. import & export
   1. 不要`import`和`require`混用，推荐使用 ESM
   2. 同一个文件不要多次`import`
   3. 未使用的`import`需要被清理
   4. import 尽量使用完整路径，不要使用相对路径、推荐使用 alias，设计要有一致性和可读性
   5. import 顺序、不要使用 import
   6. import 外部依赖命名语义不明确的情况要适当添加注释
   7. 不推荐使用`export default`导出，因为引用人可以进行重命名、如果使用类名应该和文件名一致
3. 命名
   1. 不要使用关键字命名变量
   2. const let var
   3. 命名格式
      1. 文件命名使用 kebab-case 方式，即`xxx-xxx`，全小写`-`代替空格
      2. 组件使用 PascalCase 方式命名，即`XxxXxx`，首字母大写
      3. 函数使用 camelCase 方式命名，即`xxxXxxx`，第一个单词消息，后续单词首字母大写
   4. 有意义的命名：文件、函数、类命名要有意义、保持一致性、避免无意义的前后缀
      1. 布尔类型变量命名使用：`is|should`前缀
      2. 避免无意义后缀，例如函数名包含`Func`后缀
      3. 函数名、参数名和返回结果命名命名要匹配，例如：`const user = getUserInfo()`把`user`改成`userInfo`和函数名一致会更有可读性
   5. class 变量要明确声明变量的`public`、`private`、`protected`
4. 语法问题：
   1. 要使用模板字符串实现字符串拼接
   2. 使用箭头函数替代`bind`
   3. 使用异步函数替换 callback
5. 函数
   1. 函数参数要使用 object 类型，方便扩展，便于调用方通过参数名理解参数的含义
   2. 参数范围要尽量小，不要将全部参数一次性全部传入，例如 react 中直接传入全部 props 或 states
   3. 异常优先，边界问题优先，优先处理异常逻辑，可以降低代码缩进、缩小代码块长度
   4. 代码组织顺序不符合阅读顺序，核心内容上提，私有类和方法下移
   5. 类内变量函数同上
   6. 要有适当的换行和注释
   7. 函数过长
      1. 阶段拆分
      2. 循环拆分
      3. 卫语句改下 if 嵌套
      4. 复杂 if 条件提取成函数，可以通过函数名理解判断逻辑
6. 代码设计
   1. 不能使用改变全局对象管理数据、可以使用 redux 等状态管理工具进行管理
   2. 业务代码里面不应该包含功能代码，应该首先对功能代码进行封装，例：通过网络请求获取信息，不应该在具体的业务代码中处理网络请求功能，应该对网络请求进行、网络异常、业务状态码异常进行封装
   3. 要对过大函数进行拆分，每个函数内部只处理同一层面的逻辑，如果有更深一级的代码，则将更深一级代码提取成单独函数并在当前函数调用
   4. 避免魔术字符串等硬编码行为，应该使用枚举的方式组织、给每一个状态码设置有意义的名字，并且合理的分类规划 namespace
   5. 尽量避免使用`this`，需要使用到`this`的位置可以封装单独函数，直接调用函数将需要的变量传入函数中。
   6. 类似链接初始化等只需要执行一次的函数，不应该在业务函数内部处理，可以采用单利模式封装，或者使用`once`等装饰器实现
7. React
   1. React 使用箭头函数替换 bind 绑定
   2. 未使用 this 的函数不适应作为成员函数存在，可以提前单独提取
   3. 使用 react 不用进行 dom 操作
8. 其它
   1. 删除无意义注释代码
   2. 删除调试代码`console`等
   3. 合理使用换行，段落化代码
   4. `window.xxxStorage`、`JSON.parse`等方法的调用需要使用`try catch`语句进行保护
   5. 添加判断要使用`===`，不要使用隐性类型转换
   6. 不能使用`setTimeout`进行执行顺序控制
9. libs
   1. 样式处理，styled component > className > 自己拼接 class
