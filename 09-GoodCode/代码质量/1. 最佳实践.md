# 代码质量

- 风格统一
- 单元测试
- 代码复杂度
- 代码重复率
- 代码坏味道

> 编程是一种让他人了解你想让电脑做什么的艺术 - 《计算机程序设计的艺术》 Donald Knuth

优秀代码特质：CLEAN

1. Cohesive（高内聚）：内聚的代码更容易理解和查找 bug
2. Loosely Coupled（松耦合）：代码减少代码之间的副作用，更容易测试、复用和扩展
3. Encapsulated（封装）：封装良好的代码容易修改，容易管理复杂度
4. Assertive（自主）：自主的代码不与其它代码互相干预，行为和所依赖度额数据放在一起
5. Nonredundant（无冗余）：bug 的修复和功能的修改只需要在一个地方进行

## 圈复杂度

VS Code 插件[CodeMetrics](https://marketplace.visualstudio.com/items?itemName=kisstkondoros.vscode-codemetrics)可以计算代码复杂度

## TODO:[Sonarlint](https://www.sonarlint.org/)

## 代码重复率

## 代码风格

## 测试覆盖率

## 代码坏味道

- 对象函数的问题
  - 过长函数：设置质量红线和检测机制，限制函数长度，强制对过大函数进行拆分
  - 过长参数列表：
    - 引入参数对象，将类似的参数抽象成一对象参数
    - 以查询取代参数，对应可以通过查询获得的参数，应该在函数内部使用查询获取，避免传入导致的函数可读性降低
    - 移除标记参数，对于标记类(如是否成功、类型)型的参数一般可以针对每一个类型拆分出一个单独的函数，不要在一个函数内部实现所有情况
  - 基本类型偏执：类似过长参数列表问题中的参数对象解决方案，建议使用面向对象思维，使用对象作为参数
  - 过长的 if 或 switch 语句：
    - TODO:用策略模式替代 if/switch，抽象基类，使用多个策略实现基类，然后使用工厂模式根据参数绝对执行具体的实现类
    - TODO:使用表驱动模式
    - TODO:使用责任链模式
  - if 语句嵌套过深
    - TODO:抽象方法+卫语句：先判断不满足的条件，将不满足的条件放在前面，将满足条件的处理函数放在后面，对满足条件的执行函数提取单独的方法
  - TODO:循环语句：使用`Array.prototype.map`之类的方法代替
- 对象属性问题：
  - 神秘命名：code review 变量、函数、模块的命名要能够体现它的意义
  - 魔术字符串问题：使用枚举
  - 全局数据：
  - 可变数据：要尽量封装，收回变量的控制权
  - 数据泥团：不同对象之间有相同的属性和逻辑，边距不清晰，应该针对公共的属性和方法提前父类
  - TODO:临时字段：
  - 纯数据类：指的是一个类只有数据没有方法，在设计的时候应该将数据和方法集中到一个类上
- 对象关系问题：
  - 过长调用链
- 其它问题
  - 重复代码
  - 冗赘的元素：注释代码等
  - 过大的类
  - 注释

## TODO：好的代码范式

1. 纯函数
2. 函数式编程
3. 卫语句
4. 有意义的命名，包括变量、函数、类等
5. 函数应该尽量小，包含尽量少的参数
6. 必要的注释
